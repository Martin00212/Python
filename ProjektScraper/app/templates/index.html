<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Hunter</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
        <a class="navbar-brand" href="/">
            <i class="fas fa-book"></i> Book Hunter
        </a>
    </nav>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-info text-white text-center">
                    </div>
                    <div class="card-body">
                        <form id="scrapeForm" class="grid-form">
                            <div class="form-group">
                                <label for="urls">URL:</label>
                                <input type="text" class="form-control" id="urls" name="urls" placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="sort_by">Sort by:</label>
                                <select class="form-control" id="sort_by" name="sort_by">
                                    <option value="book_name">Book Name</option>
                                    <option value="author">Author</option>
                                    <option value="price">Price</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sort_order">Sort order:</label>
                                <select class="form-control" id="sort_order" name="sort_order">
                                    <option value="asc">Ascending</option>
                                    <option value="desc">Descending</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" id="filter_by" name="filter_by" placeholder="Book name or author">
                            </div>
                            <div class="text-center mt-3">
                                <button type="submit" class="btn btn-info mr-2">
                                    <i class="fas fa-search"></i> Search
                                </button>
                                <button type="reset" class="btn btn-secondary ml-2">
                                    <i class="fas fa-undo"></i> Reset
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div id="alerts" class="mt-4"></div>

                <div class="mt-4">
                    <h3 class="text-center">Results</h3>
                    <div id="loadingSpinner" class="text-center" style="display: none;">
                        <div class="spinner-border text-info" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    <div class="grid-container" id="results"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('scrapeForm').onsubmit = async function(event) {
            event.preventDefault();
            const urls = document.getElementById('urls').value.split(',').map(url => url.trim());
            const sort_by = document.getElementById('sort_by').value;
            const sort_order = document.getElementById('sort_order').value;
            const filter_by = document.getElementById('filter_by').value;

            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultsDiv = document.getElementById('results');
            const alertsDiv = document.getElementById('alerts');

            resultsDiv.innerHTML = '';
            alertsDiv.innerHTML = '';
            loadingSpinner.style.display = 'block';

            const response = await fetch('/scrape', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ urls, sort_by, sort_order, filter_by })
            });

            loadingSpinner.style.display = 'none';
            const result = await response.json();

            if (result.status === 'success') {
                result.data.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'grid-item';
                    card.innerHTML = `
                        <div class="card shadow-sm">
                            <img src="${item.image_url}" class="card-img-top" alt="${item.book_name}">
                            <div class="card-body">
                                <h5 class="card-title">${item.book_name}</h5>
                                <p class="card-author"><i class="fas fa-user"></i> ${item.author}</p>
                                <p class="card-price"><i class="fas fa-tag"></i> ${item.price_text}</p>
                                <a href="${item.book_url}" target="_blank" class="btn btn-info mt-auto">View Book</a>
                            </div>
                        </div>
                    `;
                    resultsDiv.appendChild(card);
                });
            } else {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${result.message}`;
                alertsDiv.appendChild(alert);
            }
        };
    </script>
</body>
</html>